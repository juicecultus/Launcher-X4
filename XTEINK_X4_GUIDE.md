# Xteink X4 (ESP32-C3, 16MB) — Launcher-X4 How-To

This repository is a fork/port of the original Launcher project with added support for the **Xteink X4**.

## Status

- Xteink X4 boots and runs the Launcher build.
- SD card support and on-screen keyboard UI have been adjusted for X4.
- OTA firmware list is configurable via `hub_url` in `config.conf` (e.g. you can point it to Einkhub).

## Einkhub (marketplace) integration

Launcher reads `hub_url` from `config.conf` on the SD card. To point it at an Einkhub dev server on your LAN:

```json
"hub_url": "http://192.168.6.151:3000"
```

Notes:

- Use a LAN IP or hostname reachable from the device (not `localhost`).
- Xteink X4 build uses `OTA_TAG=third_party`, so Einkhub should serve `GET /firmwares?category=third_party`.

## What you need

- An Xteink X4 device (ESP32-C3, 16MB)
- A USB cable
- `esptool`
  - Either install it (e.g. `pip3 install esptool`), or use your PlatformIO environment’s esptool.

## Firmware artifacts (what users flash)

There are two ways to flash.

### Option A (recommended): one merged `.bin`

- **File:** `Launcher-xteink-x4.bin`
- **Where it comes from:** generated by PlatformIO post-build script `support_files/merge.py`
- **Where to find it after building:** repo root

### Option B (advanced): flash individual binaries

These are generated under:

- `.pio/build/xteink-x4/bootloader.bin`
- `.pio/build/xteink-x4/partitions.bin`
- `.pio/build/xteink-x4/firmware.bin`

## Build the firmware (to generate the `.bin` files)

From the repo root:

```sh
platformio run -e xteink-x4
```

After this, you should have:

- `Launcher-xteink-x4.bin` (repo root)
- `.pio/build/xteink-x4/firmware.bin`
- `.pio/build/xteink-x4/partitions.bin`
- `.pio/build/xteink-x4/bootloader.bin`

## Flash offsets for Xteink X4

These offsets are what the project uses:

- **Bootloader:** `0x0000`
- **Partition table:** `0x8000`
- **Application:** `0x10000`

The X4 partition layout CSV is:

- `support_files/xteink_x4_16Mb.csv`

## Put the device in flashing mode

Typical ESP32-C3 procedure:

- Hold **BOOT**
- Tap **RESET** (or plug USB while holding BOOT)
- Release **BOOT** after flashing starts

## Flash commands (esptool)

Replace the serial port with your device port, for example:

- macOS: `/dev/cu.usbmodem1101`

### Option A: flash the merged image (recommended)

```sh
python3 -m esptool --chip esp32c3 --port /dev/cu.usbmodem1101 --baud 921600 \
  write_flash -z 0x0000 Launcher-xteink-x4.bin
```

### Clean flash (erases Wi-Fi creds/config)

```sh
python3 -m esptool --chip esp32c3 --port /dev/cu.usbmodem1101 erase_flash
python3 -m esptool --chip esp32c3 --port /dev/cu.usbmodem1101 --baud 921600 \
  write_flash -z 0x0000 Launcher-xteink-x4.bin
```

### Option B: flash individual parts

#### Partition table only (fixes partition/otadata layout)

```sh
python3 -m esptool --chip esp32c3 --port /dev/cu.usbmodem1101 --baud 921600 \
  write_flash -z 0x8000 .pio/build/xteink-x4/partitions.bin
```

#### App only (normal dev iteration)

```sh
python3 -m esptool --chip esp32c3 --port /dev/cu.usbmodem1101 --baud 921600 \
  write_flash -z 0x10000 .pio/build/xteink-x4/firmware.bin
```

#### Bootloader + partitions + app

```sh
python3 -m esptool --chip esp32c3 --port /dev/cu.usbmodem1101 --baud 921600 \
  write_flash -z \
  0x0000  .pio/build/xteink-x4/bootloader.bin \
  0x8000  .pio/build/xteink-x4/partitions.bin \
  0x10000 .pio/build/xteink-x4/firmware.bin
```

## Troubleshooting

- If flashing fails at `921600`, retry with `460800` or `115200`.
- After flashing, the device may re-enumerate and your serial port name may change.
- If you only flash the app (`0x10000`), partition-table related issues will not be fixed.


IMPORTANT, when Launcher splash shows press OK on your Xteink X4to enter the main menu. 
